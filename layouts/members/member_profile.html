{{ define "content" }}

{{ $member_id := .Params.member_id }}
{{ $profile := .Params.profile }}

{{ if $profile }}
<div class="outer">
  <div class="inner">
    <article class="member-profile">

      <!-- Header: Photo + Name + Intro + Social Links -->
      <div class="member-profile-header">
        <div class="member-profile-photo">
          {{ $imagePath := printf "/members/%s/%s" $member_id ($profile.image_path | default "") }}
          {{ $defaultImg := "/members/me.jpeg" }}
          {{ if and $profile.image_path (ne $profile.image_path "") }}
            <img class="member-profile-img" src="{{ $imagePath }}" alt="{{ $profile.full_name }}" onerror="this.src='{{ $defaultImg }}'">
          {{ else }}
            <img class="member-profile-img" src="{{ $defaultImg }}" alt="{{ $profile.full_name }}">
          {{ end }}
        </div>
        <div class="member-profile-info">
          <h1 class="member-profile-name">{{ $profile.full_name }}</h1>

          {{ with $profile.introduction }}
            {{ if ne . "" }}
              <p class="member-profile-intro">{{ . }}</p>
            {{ end }}
          {{ end }}

          <!-- Social Links -->
          {{ with $profile.social_links }}
            <div class="member-profile-social">
              {{ with .website }}{{ if ne . "" }}
                <a href="{{ . }}" target="_blank" rel="noopener" title="Website">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                </a>
              {{ end }}{{ end }}
              {{ with .github_handle }}{{ if ne . "" }}
                <a href="https://github.com/{{ . }}" target="_blank" rel="noopener" title="GitHub">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                </a>
              {{ end }}{{ end }}
              {{ with .twitter_handle }}{{ if ne . "" }}
                <a href="https://twitter.com/{{ . }}" target="_blank" rel="noopener" title="Twitter/X">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                </a>
              {{ end }}{{ end }}
              {{ with .linkedin_handle }}{{ if ne . "" }}
                <a href="https://linkedin.com/in/{{ . }}" target="_blank" rel="noopener" title="LinkedIn">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                </a>
              {{ end }}{{ end }}
              {{ with .email }}{{ if ne . "" }}
                <a href="mailto:{{ . }}" title="Email">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                </a>
              {{ end }}{{ end }}
              {{ with .orcid }}{{ if ne . "" }}
                <a href="https://orcid.org/{{ . }}" target="_blank" rel="noopener" title="ORCID">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 256 256"><path fill="#a6ce39" d="M256 128c0 70.7-57.3 128-128 128S0 198.7 0 128 57.3 0 128 0s128 57.3 128 128z"/><path fill="#fff" d="M86.3 186.2H70.9V79.1h15.4v107.1zM108.9 79.1h41.6c39.6 0 57 28.3 57 53.6 0 27.5-21.5 53.6-56.8 53.6h-41.8V79.1zm15.4 93.3h24.5c34.9 0 42.9-26.5 42.9-39.7 0-21.5-13.7-39.7-42.5-39.7h-24.9v79.4zM88.7 56.8c0 5.5-4.5 10.1-10.1 10.1s-10.1-4.6-10.1-10.1c0-5.6 4.5-10.1 10.1-10.1s10.1 4.6 10.1 10.1z"/></svg>
                </a>
              {{ end }}{{ end }}
            </div>
          {{ end }}
        </div>
      </div>

      <!-- TARDIS Roles -->
      {{ with $profile.tardis_roles }}
        {{ $has_roles := false }}
        {{ if index . "tardis_core_team" }}{{ $has_roles = true }}{{ end }}
        {{ if index . "tardis_collaboration" }}{{ $has_roles = true }}{{ end }}
        {{ if $has_roles }}
        <div class="member-profile-section">
          <h2>TARDIS Roles</h2>
          <table>
            <thead>
              <tr><th>Role</th><th>Period</th></tr>
            </thead>
            <tbody>
              {{ with index . "tardis_core_team" }}
                {{ range . }}
                <tr>
                  <td>Core Team &mdash; {{ .role }}</td>
                  <td>{{ .start_date }} &ndash; {{ if .end_date }}{{ .end_date }}{{ else }}Present{{ end }}</td>
                </tr>
                {{ end }}
              {{ end }}
              {{ with index . "tardis_collaboration" }}
                <tr>
                  <td>Collaborator{{ with .expertise }} ({{ delimit . ", " }}){{ end }}</td>
                  <td>{{ .start_date }} &ndash; {{ if .end_date }}{{ .end_date }}{{ else }}Present{{ end }}</td>
                </tr>
              {{ end }}
            </tbody>
          </table>
        </div>
        {{ end }}
      {{ end }}

      <!-- Education -->
      {{ if and $profile.education (gt (len $profile.education) 0) }}
      <div class="member-profile-section">
        <h2>Education</h2>
        <table>
          <thead>
            <tr><th>Institution</th><th>Years</th><th>Qualification</th></tr>
          </thead>
          <tbody>
            {{ range $profile.education }}
            <tr>
              <td>{{ .institution }}{{ with .city }}, {{ . }}{{ end }}{{ with .country }}, {{ . }}{{ end }}</td>
              <td>{{ with .start_date }}{{ slicestr . 0 4 }}{{ end }} &ndash; {{ with .end_date }}{{ slicestr . 0 4 }}{{ else }}Present{{ end }}</td>
              <td>{{ .degree }}{{ with .subject }} in {{ . }}{{ end }}</td>
            </tr>
            {{ end }}
          </tbody>
        </table>
      </div>
      {{ end }}

      <!-- Experience -->
      {{ if and $profile.experiences (gt (len $profile.experiences) 0) }}
      <div class="member-profile-section">
        <h2>Experience</h2>
        <table>
          <thead>
            <tr><th>Institution</th><th>Years</th><th>Role</th></tr>
          </thead>
          <tbody>
            {{ range $profile.experiences }}
            <tr>
              <td>{{ with .institution }}{{ . }}{{ end }}{{ with .group }} ({{ . }}){{ end }}</td>
              <td>{{ with .start_date }}{{ slicestr . 0 4 }}{{ end }} &ndash; {{ with .end_date }}{{ slicestr . 0 4 }}{{ else }}Present{{ end }}</td>
              <td>{{ .role }}</td>
            </tr>
            {{ end }}
          </tbody>
        </table>
      </div>
      {{ end }}

      <!-- Projects -->
      {{ if and $profile.projects (gt (len $profile.projects) 0) }}
      <div class="member-profile-section">
        <h2>Projects</h2>
        <table>
          <thead>
            <tr><th>Project</th><th>Years</th><th>Description</th></tr>
          </thead>
          <tbody>
            {{ range $profile.projects }}
            <tr>
              <td>{{ .project_title }}</td>
              <td>{{ with .start_date }}{{ slicestr . 0 4 }}{{ end }}{{ with .end_date }} &ndash; {{ slicestr . 0 4 }}{{ end }}</td>
              <td>{{ .description }}</td>
            </tr>
            {{ end }}
          </tbody>
        </table>
      </div>
      {{ end }}

      <!-- Awards -->
      {{ if and $profile.awards (gt (len $profile.awards) 0) }}
      <div class="member-profile-section">
        <h2>Awards &amp; Recognition</h2>
        <table>
          <thead>
            <tr><th>Title</th><th>Year</th><th>Description</th></tr>
          </thead>
          <tbody>
            {{ range $profile.awards }}
            <tr>
              <td>{{ .award_name }}</td>
              <td>{{ with .date }}{{ slicestr . 0 4 }}{{ end }}</td>
              <td>{{ .description }}</td>
            </tr>
            {{ end }}
          </tbody>
        </table>
      </div>
      {{ end }}

      <!-- Outreach -->
      {{ if and $profile.outreach (gt (len $profile.outreach) 0) }}
      <div class="member-profile-section">
        <h2>Outreach</h2>
        <table>
          <thead>
            <tr><th>Program</th><th>Years</th><th>Details</th></tr>
          </thead>
          <tbody>
            {{ range $profile.outreach }}
            <tr>
              <td>{{ .program_name }}</td>
              <td>{{ with .start_date }}{{ slicestr . 0 4 }}{{ end }}{{ with .end_date }} &ndash; {{ slicestr . 0 4 }}{{ end }}</td>
              <td>{{ .description }}</td>
            </tr>
            {{ end }}
          </tbody>
        </table>
      </div>
      {{ end }}

      <!-- GSoC Participation -->
      {{ with $profile.tardis_roles }}
        {{ with index . "gsoc_participation" }}
          {{ if gt (len .) 0 }}
          <div class="member-profile-section">
            <h2>GSoC Participation</h2>
            <table>
              <thead>
                <tr><th>Year</th><th>Project</th><th>Mentors</th></tr>
              </thead>
              <tbody>
                {{ range . }}
                <tr>
                  <td>{{ .year }}</td>
                  <td>{{ if .project_link }}<a href="{{ .project_link }}" target="_blank" rel="noopener">{{ .project_title }}</a>{{ else }}{{ .project_title }}{{ end }}</td>
                  <td>{{ with .mentors }}{{ delimit . ", " }}{{ end }}</td>
                </tr>
                {{ end }}
              </tbody>
            </table>
          </div>
          {{ end }}
        {{ end }}
      {{ end }}

      <!-- GSoC Mentorship -->
      {{ with $profile.tardis_roles }}
        {{ with index . "gsoc_mentorship" }}
          {{ $has_mentees := false }}
          {{ range . }}{{ if .mentee_ids }}{{ if gt (len .mentee_ids) 0 }}{{ $has_mentees = true }}{{ end }}{{ end }}{{ end }}
          {{ if $has_mentees }}
          <div class="member-profile-section">
            <h2>GSoC Mentorship</h2>
            <table>
              <thead>
                <tr><th>Year</th><th>Mentees</th></tr>
              </thead>
              <tbody>
                {{ range . }}
                  {{ if and .mentee_ids (gt (len .mentee_ids) 0) }}
                  <tr>
                    <td>{{ .year }}</td>
                    <td>{{ delimit .mentee_ids ", " }}</td>
                  </tr>
                  {{ end }}
                {{ end }}
              </tbody>
            </table>
          </div>
          {{ end }}
        {{ end }}
      {{ end }}

    </article>
  </div>
</div>
{{ end }}

{{ end }}
